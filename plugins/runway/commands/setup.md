---
command: setup
description: Initialize runway configuration for the project
arguments: [environment]
---

# Runway Setup Command

Quick initialization of runway configuration.

## Usage

```bash
/runway setup                    # Interactive setup
/runway setup dev               # Setup for dev environment
/runway setup prod              # Setup for prod environment
```

## What This Does

1. **Scans Project**: Identifies Terraform modules and CloudFormation stacks
2. **Creates runway.yml**: Generates base configuration
3. **Environment Files**: Creates environment-specific variable files
4. **Hook Configuration**: Sets up npm build and env generation hooks if needed

## Arguments

- `environment` (optional): Target environment to configure (dev, staging, prod)
  - If not provided, prompts for environments interactively

## Examples

```bash
# Interactive setup - will ask questions
/runway setup

# Quick setup for production
/runway setup prod

# Setup development environment
/runway setup dev
```

## What Gets Created

- `runway.yml` - Main runway configuration
- `*.tfvars` - Terraform variable files per environment (e.g., `prod.tfvars`, `dev.tfvars`)
- `*.env` - CFNgin environment files (e.g., `prod.env`, `dev.env`)
- Hook configurations for npm builds and .env generation (if applicable)

## For Complex Setup

For more comprehensive initialization with:
- Multiple modules/stacks
- Custom hook configuration
- Advanced environment setup
- Interactive guidance

Use the agent instead:
```
"Set up runway for this project with dev and prod environments"
```

The `runway-setup` agent will provide step-by-step guidance and handle complex scenarios.

## Script

```bash
#!/bin/bash

# Get environment argument or default to interactive
ENVIRONMENT="${1:-}"

echo "ğŸš€ Runway Setup"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# Check if runway.yml already exists
if [ -f "runway.yml" ]; then
    echo "âš ï¸  runway.yml already exists"
    read -p "Overwrite? (y/N): " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        echo "âŒ Setup cancelled"
        exit 1
    fi
fi

# Scan for modules
echo "ğŸ“ Scanning for infrastructure modules..."
echo ""

# Look for Terraform modules
TF_MODULES=$(find . -maxdepth 3 -name "*.tf" -exec dirname {} \; | sort -u | grep -v ".terraform" | head -10)
# Look for CloudFormation templates
CFN_STACKS=$(find . -maxdepth 3 -name "*.yaml" -o -name "*.yml" | grep -E "(template|stack|cfn)" | head -10)

if [ -z "$TF_MODULES" ] && [ -z "$CFN_STACKS" ]; then
    echo "âš ï¸  No Terraform or CloudFormation modules found"
    echo "Please ensure you have .tf files or CloudFormation templates"
    exit 1
fi

# Show found modules
if [ -n "$TF_MODULES" ]; then
    echo "âœ… Found Terraform modules:"
    echo "$TF_MODULES" | sed 's/^/   - /'
    echo ""
fi

if [ -n "$CFN_STACKS" ]; then
    echo "âœ… Found CloudFormation templates:"
    echo "$CFN_STACKS" | sed 's/^/   - /'
    echo ""
fi

# Get environments if not provided
if [ -z "$ENVIRONMENT" ]; then
    echo "ğŸ“‹ Which environments do you need? (comma-separated)"
    echo "   Examples: dev,prod  or  dev,staging,prod"
    read -p "Environments: " ENVIRONMENTS
else
    ENVIRONMENTS="$ENVIRONMENT"
fi

# Convert comma-separated to array
IFS=',' read -ra ENV_ARRAY <<< "$ENVIRONMENTS"

echo ""
echo "ğŸ”§ Creating configuration files..."
echo ""

# Create basic runway.yml (Claude will need to populate this based on found modules)
cat > runway.yml << 'EOF'
# Runway Configuration
# Generated by /runway setup

deployments:
  # Modules will be added here
EOF

echo "âœ… Created runway.yml"

# Create environment variable files for each module and environment
for module in $TF_MODULES; do
    module_name=$(basename "$module")
    for env in "${ENV_ARRAY[@]}"; do
        env=$(echo "$env" | xargs)  # trim whitespace
        tfvars_file="${module}/${env}.tfvars"

        # Create tfvars if it doesn't exist
        if [ ! -f "$tfvars_file" ]; then
            cat > "$tfvars_file" << EOF
# Terraform variables for ${env} environment
# Module: ${module_name}

# Add your variables here
# Example:
# region = "us-east-1"
# environment = "${env}"
EOF
            echo "âœ… Created ${tfvars_file}"
        fi
    done
done

echo ""
echo "âœ… Runway setup complete!"
echo ""
echo "ğŸ“ Next steps:"
echo "   1. Edit runway.yml to configure your deployments"
echo "   2. Update *.tfvars files with your environment-specific values"
echo "   3. Run: /runway validate"
echo ""
echo "ğŸ’¡ For comprehensive setup with hooks and advanced config:"
echo "   Ask: 'Set up runway for this project with hooks'"
```
